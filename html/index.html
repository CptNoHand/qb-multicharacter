
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link href="reset.css" rel="stylesheet">
    <link href="style.css" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <title>QB-Multicharacter</title>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <script src="vue.js"></script>
    <script src="swal2.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css" rel="stylesheet"/>
</head>
    <body>
        <audio id="click" src="click.wav"></audio>
        <audio id="musica_fondo" src="musica.mp3" loop></audio>
        <div class="container">     
            <div class="main-screen">
                <div class="fondocolor"></div>
                <div class="topbar" style="display: block; top: 0%;"></div>
                <img class="imagenlogo" style="display: none; top: 50%;" src="qb-pixel.png">
                <div class="bottombar" style="display: block; top: 50%;"></div> 

                <div class="welcomescreen">
                    <div class="loading-rondje">
                        <div class="lds-ring"><div></div><div></div><div></div><div></div></div>                        
                        <p id="loading-text">Loading Characters</p>
                    </div>
                </div>
                <div class="title-screen">
                    <div class="fondo-negro"></div>
                    <div class="contenedor">
                        <div class="btn-iniciar">Live your Life</div>
                    </div>
                </div>
                <div class="jugadores-on" id="total-players">players</div> 
                <div class="characters-list">
                    <div class="character-logo"><img class="headimageleft" src="qb-pixel.png"></div>
                    <div class="character-list-header"><p>Mis personajes</p></div>
                    <div class="character" id="char-1" data-cid="">
                        <span id="slot-name">  <i class="fa fa-user-plus" aria-hidden="true" style="color: rgb(54, 255, 47);"></i>  Create New Character<span id="cid"></span></span>
                    </div>
                    <div class="character" id="char-2" data-cid="">
                        <span id="slot-name">  <i class="fa fa-user-plus" aria-hidden="true" style="color: rgb(54, 255, 47);"></i>  Create New Character<span id="cid"></span></span>
                    </div>
                    <div class="character" id="char-3" data-cid="">
                        <span id="slot-name">  <i class="fa fa-user-plus" aria-hidden="true" style="color: rgb(54, 255, 47);"></i>  Create New Character<span id="cid"></span></span>
                    </div>
                    <div class="character" id="char-4" data-cid="">
                        <span id="slot-name">  <i class="fa fa-user-plus" aria-hidden="true" style="color: rgb(54, 255, 47);"></i>  Create New Character<span id="cid"></span></span>
                    </div>
                    <div class="character" id="char-5" data-cid="">
                        <span id="slot-name">  <i class="fa fa-user-plus" aria-hidden="true" style="color: rgb(54, 255, 47);"></i>  Create New Character<span id="cid"></span></span>
                    </div>
                    <div class="character-btn" id="play"><p id="play-text">Select a character</p></div>
                    <div class="character-btn" id="delete"><p id="delete-text">Select a character</p></div>
                </div>

                <div class="character-info">
                    <div class="char-info-titel"><i class="material-icons" id="char-info-icon">info</i><span id="char-info-titel">Character Information</span></div>
                    <div class="character-info-valid">
                        <span id="no-char">Select a character slot to see all information about your character.</span>
                    </div>
                </div>
                
                <div class="character-register">
                    <div class="characters-register-block-header">
                        <p>Character Registration</p>
                        <span class="material-symbols-outlined" id="close-reg">close</span>
                    </div>
                    <div class="char-register-inputs">
                        <input type="text" id="first_name" placeholder="First Name" class="char-reg-input">
                        <input type="text" id="last_name" placeholder="Last Name" class="char-reg-input">
                        <input type="text" id="nationality" placeholder="Nationality" class="char-reg-input">
                        <input type="date" id="birthdate" placeholder="Birth Date" min="1900-01-01" max="2999-12-31" class="char-reg-input">
                        <select id="gender" name="gender">
                            <option value="Male" selected>Man</option>
                            <option value="Female">Woman</option>
                        </select>
                    </div>
                    <div class="character-reg-btn" id="create"><p id="create-text">Confirm</p></div>
                </div>

                <div class="character-delete">
                    <div class="characters-delete-block-header">
                        <p>Delete Character</p>
                    </div>

                    <p>Are You Sure You Want To Delete Your Character?</p>

                    <div class="character-acceptdel-btn" id="accept-delete"><p id="accept-text">Confirm</p></div>
                    <div class="character-canceldel-btn" id="cancel-delete"><p id="cancel-text">Return</p></div>
                </div>
                <div class="error">
                    <div class="error-title"><span class="material-symbols-outlined">error</span>Error!</div>
                    <div class="error-msg"></div>
                    <div class="close-err-btn" id="close-error"><p id="cancel-error">Close</p></div>
                </div>
            </div>
        </div>
    </body>
    <script type="text/javascript" src="profanity.js"></script>
    <script>
        let re = '(' + profList.join('|') + ')\\b'
        const regTest = new RegExp(re, 'i');

        const viewmodel = new Vue({
            el: "#app",
            vuetify: new Vuetify(),
            data: {
                characters: [],
                chardata: {},
                show: {
                    loading: false,
                    characters: false,
                    register: false,
                    delete: false
                },
                registerData: {
                    date: (new Date(Date.now() - (new Date()).getTimezoneOffset() * 60000)).toISOString().substr(0, 10),
                    firstname: undefined,
                    lastname: undefined,
                    nationality: undefined,
                    gender: undefined
                },
                allowDelete: false,
                dataPickerMenu: false,
                characterAmount: 0,
                loadingText: "",
                selectedCharacter: -1,
                dollar: Intl.NumberFormat('en-US')
            },
            methods: {
                click_character: function(idx, type) {
                    viewmodel.selectedCharacter = idx

                    if (viewmodel.characters[idx] !== undefined) {
                        axios.post('https://qb-multicharacter/cDataPed', {
                            cData: viewmodel.characters[idx]
                        });
                    }
                    else {
                        axios.post('https://qb-multicharacter/cDataPed', {})
                    }
                },

                save: function(date) {
                    this.$refs.menu.save(date)
                },

                delete_character: function() {
                    if (viewmodel.show.delete == true) {
                        viewmodel.show.delete = false
                        axios.post('https://qb-multicharacter/removeCharacter', {
                            citizenid: viewmodel.characters[viewmodel.selectedCharacter].citizenid
                        });
                    }
                    else {
                        if (viewmodel.show.characters == true && viewmodel.show.register == false) {
                            viewmodel.show.characters = false
                            viewmodel.show.delete = true
                        }
                    }
                },

                play_character: function() {
                    if (viewmodel.selectedCharacter && viewmodel.selectedCharacter !== -1) {
                        var data = viewmodel.characters[viewmodel.selectedCharacter]

                        if (data !== undefined) {
                            axios.post('https://qb-multicharacter/selectCharacter', {
                                cData: data
                            });
                            setTimeout(function() {
                                viewmodel.show.characters = false
                            }, 500)
                        }
                        else {
                            viewmodel.registerData.firstname = undefined
                            viewmodel.registerData.lastname = undefined
                            viewmodel.registerData.nationality = undefined
                            viewmodel.registerData.gender = undefined
                            viewmodel.registerData.date = (new Date(Date.now() - (new Date()).getTimezoneOffset() * 60000)).toISOString().substr(0, 10)

                            viewmodel.show.characters = false
                            viewmodel.show.register = true
                        }
                    }

                },

                create_character: function() {
                    var profanityTest = (!regTest.test(viewmodel.registerData.firstname) && !regTest.test(viewmodel.registerData.nationality) && !regTest.test(viewmodel.registerData.lastname))

                    if (viewmodel.registerData.firstname !== undefined && profanityTest && viewmodel.registerData.lastname !== undefined && viewmodel.registerData.gender !== undefined && viewmodel.registerData.nationality !== undefined && viewmodel.registerData.date !== undefined) {
                        viewmodel.show.register = false

                        axios.post('https://qb-multicharacter/createNewCharacter', {
                            firstname: viewmodel.registerData.firstname,
                            lastname: viewmodel.registerData.lastname,
                            nationality: viewmodel.registerData.nationality,
                            birthdate: viewmodel.registerData.date,
                            gender: viewmodel.registerData.gender,
                            cid: viewmodel.selectedCharacter,
                        });
                    }
                    else {
                        if (!profanityTest) {
                            Swal.fire({
                                icon: 'error',
                                title: 'We ran into an issue',
                                text: 'It seems like you are trying to use some type of profanity / bad words in your name or nationality!',
                                timer: 5000,
                                timerProgressBar: true,
                                showConfirmButton: false
                            })
                        }
                        else {
                            Swal.fire({
                                icon: 'error',
                                title: 'We ran into an issue',
                                text: 'It seems like you have forgotten to input one or multiple of the fields!',
                                timer: 5000,
                                timerProgressBar: true,
                                showConfirmButton: false
                            })
                        }
                    }
                }
            },
            mounted () {
                var loadingProgress = 0;
                var loadingDots = 0;
                window.addEventListener('message', function (event) {
                    var data = event.data;
                    if (data.action == "ui") {
                        viewmodel.characterAmount = data.nChar;
                        viewmodel.selectedCharacter = -1
                        viewmodel.show.register = false
                        viewmodel.show.delete = false
                        viewmodel.show.characters = false
                        viewmodel.allowDelete = event.data.enableDeleteButton
                        EnableDeleteButton = data.enableDeleteButton;
                        if (data.toggle) {
                            viewmodel.show.loading = true

                            viewmodel.loadingText = "Retrieving player data";
                            var DotsInterval = setInterval(function () {
                                loadingDots++;
                                loadingProgress++;
                                if (loadingProgress == 3) {
                                    viewmodel.loadingText = "Validating player data"
                                }
                                if (loadingProgress == 4) {
                                    viewmodel.loadingText = "Retrieving characters"
                                }
                                if (loadingProgress == 6) {
                                    viewmodel.loadingText = "Validating characters"
                                }
                                if (loadingDots == 4) {
                                    loadingDots = 0;
                                }
                            }, 500);

                            setTimeout(function () {
                                axios.post('https://qb-multicharacter/setupCharacters');
                                setTimeout(function () {
                                    clearInterval(DotsInterval);
                                    loadingProgress = 0;
                                    viewmodel.loadingText = "Retrieving data";
                                    viewmodel.show.loading = false
                                    viewmodel.show.characters = true
                                    axios.post('https://qb-multicharacter/removeBlur');
                                }, 2000);
                            }, 2000);
                        }
                    }

                    if (data.action == "setupCharacters") {
                        var newChars = []
                        for (var i = 0; i < event.data.characters.length; i++) {
                            newChars[event.data.characters[i].cid] = event.data.characters[i]
                        }
                        viewmodel.characters = newChars
                    }

                    if (data.action == "setupCharInfo") {
                        viewmodel.chardata = event.data.chardata
                    }
                });
            }
        });
    </script>
</html>
